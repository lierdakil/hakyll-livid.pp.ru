---
author: Livid
date: 2011-05-11 09:25:28+00:00
title: Особенности Softraid ч. 2
wordpress_id: 523
tags: Gentoo, kernel, mdadm, softraid ,Gentoo, kernel
...

Еще кое-что стоит помнить при работе с линуксовым софтрейдом и метадатой
0.90. Если в рейде находятся, скажем /dev/sda2 -- причем раздел
находится в самом конце диска -- то автодетект может запутаться и
случайно воткнуть в рейд /dev/sda вместо /dev/sda2, что, в общем, смерть
данным и системе\*. Еще может не собрать ничего, что в данном случае
оптимальный вариант, но от этого не легче.
Выходов два. Либо оставлять какое-то пространство в конце диска
неразмеченным (минимум 128К), либо не пользоваться автодетектом, а
честно писать всё в mdadm.conf.

\* Для любопытных, происходит такое потому, что в 0.90 суперблок рейда
размещается в самом конце диска. Но "самый конец" оказывается и у
раздела, и у всего диска в одном месте. А в суперблоке не прописано, к
чему он относится -- к разделу, или к диску. Так что угадать шанс
минимальный. Ситуация усугубляется, если в рейде несколько "последних
разделов" -- по теории вероятностей, для двух дисков шанс собрать массив
правильно -- 1/4 (хотя принцип сборки не совершенно случаен, так что на
самом деле еще меньше), для трех -- 1/8, и так далее.
